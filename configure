#!/usr/bin/env python
import os
import optparse

root_dir = os.path.dirname(os.path.realpath(__file__))

def write(filename, data):
    filename = os.path.join(root_dir, filename)
    print('creating ' + filename)
    f = open(filename, 'w+')
    f.write(data)
    f.close()

def main():
    parser = optparse.OptionParser()

    parser.add_option('--prefix',
        action='store',
        dest='prefix',
        help='Select the installation destination directory (defaults to /usr/local)')

    parser.add_option('--without-init-script',
        action='store_true',
        dest='without_init_script',
        help='Not install init script')

    (options, args) = parser.parse_args()
    
    config = {
        'INITSCRIPT': str(int(not options.without_init_script))
    }
    
    if options.prefix:
        config['PREFIX'] = options.prefix
    
    config = '\n'.join(map('='.join, config.iteritems())) + '\n'
    write('config.mk', '# Do not edit. Generated by the configure script.\n' + config)

if __name__ == '__main__':
    main()
